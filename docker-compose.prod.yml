# Production overrides - use with: docker-compose -f docker-compose.yml -f docker-compose.prod.yml up
# This file removes exposed ports for databases and requires explicit environment variables

services:
  postgres:
    ports: !reset []
    environment:
      POSTGRES_USER: ${DB_USER:?DB_USER is required}
      POSTGRES_PASSWORD: ${DB_PASSWORD:?DB_PASSWORD is required}
      POSTGRES_DB: ${DB_NAME:?DB_NAME is required}
    restart: unless-stopped

  redis:
    ports: !reset []
    restart: unless-stopped

  backend:
    environment:
      NODE_ENV: production
      PORT: 5001
      DB_HOST: postgres
      DB_PORT: 5432
      DB_NAME: ${DB_NAME:?DB_NAME is required}
      DB_USER: ${DB_USER:?DB_USER is required}
      DB_PASSWORD: ${DB_PASSWORD:?DB_PASSWORD is required}
      JWT_SECRET: ${JWT_SECRET:?JWT_SECRET is required}
      REDIS_URL: redis://redis:6379
      CORS_ORIGIN: ${CORS_ORIGIN:?CORS_ORIGIN is required}
    restart: unless-stopped

  frontend:
    restart: unless-stopped
